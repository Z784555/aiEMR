# 云脑诊疗系统 - 病历助手前端

## 项目简介

这是一个基于 Vue 3 + TypeScript 开发的智能病历助手前端应用，为医生提供对话式病历生成、实时病历编辑、病历查询和管理等功能。系统通过自然语言对话的方式，帮助医生快速完成病历录入，并实时生成结构化的电子病历。

## 主要功能

### 1. 对话式病历生成（首页）
- **智能对话**：医生可以通过自然语言描述患者信息、主诉、诊断、处方等内容
- **实时同步**：对话过程中，右侧病历卡片会实时更新，自动提取和填充病历字段
- **AI助手**：内置"智护医"AI助手，自动分析对话内容并生成结构化病历数据
- **病历查询**：支持按就诊科室、就诊号搜索已生成的病历记录
- **病历加载**：可以快速加载历史病历记录，继续编辑或查看

### 2. 完整病历管理（病历页）
- **病历展示**：完整展示所有病历字段，包括患者信息、病史、诊断、处方等
- **在线编辑**：支持直接编辑病历内容，包括文本输入、下拉选择等
- **保存功能**：将病历保存到后端数据库
- **归档功能**：将病历归档并提交到后台系统
- **打印功能**：支持打印病历，自动优化打印样式
- **返回首页**：快速返回对话式病历生成页面

### 3. 数据管理
- **本地缓存**：使用 localStorage 缓存病历记录列表
- **会话存储**：使用 sessionStorage 保存当前编辑的病历
- **数据同步**：与后端API实时同步，支持保存和归档操作

## 技术栈

- **框架**：Vue 3.5.22（Composition API）
- **语言**：TypeScript 5.6.2
- **路由**：Vue Router 4.6.3
- **构建工具**：Vite 7.1.11
- **代码规范**：ESLint 9.37.0 + Prettier 3.6.2
- **开发工具**：Vue DevTools

## 环境要求

- Node.js: `^20.19.0 || >=22.12.0`
- npm 或 yarn

## 安装和运行

### 1. 安装依赖

```bash
npm install
```

### 2. 配置后端API地址

在项目根目录创建 `.env` 文件（或修改 `.env.local`），配置后端服务地址：

```env
VITE_API_BASE_URL=http://localhost:8080
```

如果不配置，默认使用 `http://localhost:8080`

### 3. 启动开发服务器

```bash
npm run dev
```

启动后，访问 `http://localhost:5173`（或终端显示的地址）

### 4. 构建生产版本

```bash
npm run build
```

构建产物将输出到 `dist` 目录

### 5. 预览生产构建

```bash
npm run preview
```

### 6. 代码检查和格式化

```bash
# 运行 ESLint 检查并自动修复
npm run lint

# 格式化代码
npm run format
```

## 项目结构

```
AIEMRH/
├── src/
│   ├── main.ts                 # 应用入口文件
│   ├── App.vue                 # 根组件（包含导航和布局）
│   ├── router/
│   │   └── index.ts            # 路由配置
│   ├── views/
│   │   ├── HomeView.vue        # 首页（对话式病历生成）
│   │   └── EmrView.vue         # 病历页（完整病历展示和编辑）
│   ├── services/
│   │   ├── apiService.ts       # API配置和工具函数（字段名转换）
│   │   ├── backendService.ts   # 后端API调用（获取病历数据）
│   │   ├── emrOperations.ts   # 病历操作（保存、归档、查询等）
│   │   └── toolCalling.ts      # 工具调用相关
│   ├── types/
│   │   ├── api.ts              # API相关类型定义
│   │   └── emr.ts              # 病历数据模型类型定义
│   └── env.d.ts                # 环境变量类型定义
├── public/                      # 静态资源目录
├── index.html                   # HTML入口文件
├── vite.config.ts              # Vite配置文件
├── tsconfig.json               # TypeScript配置
├── package.json                # 项目依赖和脚本
└── README.md                   # 项目说明文档（本文件）
```

## 功能使用说明

### 对话式病历生成

1. **输入患者信息**：在首页左侧对话框输入患者相关信息
   - 例如："患者张三，男，45岁，主诉咽喉肿痛3天"
   - 例如："诊断：风热感冒，处方：银翘散加减，3剂"

2. **实时查看病历**：右侧病历卡片会实时更新，显示提取的信息

3. **编辑病历**：点击"编辑"按钮，可以手动修改病历字段

4. **保存病历**：编辑完成后点击"保存"按钮，将病历保存到后端

5. **归档病历**：点击"归档"按钮，将病历提交到后台系统

6. **查询病历**：在右下角搜索面板中，输入就诊科室或就诊号进行查询

7. **加载病历**：在查询结果中点击"加载病历"按钮，可以加载历史病历继续编辑

### 完整病历管理

1. **查看病历**：点击导航栏"诊疗记录"或首页的"打开完整病历页"按钮

2. **编辑病历**：点击"编辑"按钮，进入编辑模式，修改完成后点击"保存"

3. **打印病历**：点击"打印"按钮，浏览器会打开打印预览

4. **返回首页**：点击"返回首页"按钮，回到对话式病历生成页面

## API接口说明

### 后端接口

系统通过以下接口与后端Java服务通信：

- **获取病历记录**：`GET /emr/record?input={用户输入}`
  - 参数：`input` - 用户输入的自然语言文本
  - 返回：JSON格式的病历数据（可能包含代码块标记）

### 数据格式转换

- **前端格式**：使用驼峰命名（camelCase），如 `patientName`、`visitNo`
- **后端格式**：使用下划线命名（snake_case），如 `patient_name`、`visit_no`
- **自动转换**：系统会自动处理前后端字段名的转换

## 病历数据模型

病历记录包含以下字段：

### 患者基本信息
- `patientName`：患者姓名
- `gender`：性别（男/女/其他）
- `age`：年龄（0-120）
- `phone`：联系电话
- `address`：家庭住址

### 就诊信息
- `visitNo`：就诊号（唯一标识）
- `deptName`：就诊科室
- `visitTime`：就诊时间（ISO格式）
- `visitType`：就诊类型（初诊/复诊/急诊/转诊）

### 病历内容
- `mainComplaint`：主诉
- `presentIllness`：现病史
- `pastIllness`：既往史
- `allergyHistory`：过敏史
- `diagnosis`：诊断结果
- `prescription`：处方
- `suggestion`：医嘱建议

### 医师信息
- `doctorName`：医师姓名
- `signatureUrl`：医师手签图片URL

## 本地存储说明

### localStorage
- **键名**：`emr_records_cache`
- **用途**：缓存已生成的病历记录列表
- **格式**：JSON数组

### sessionStorage
- **键名**：`current_emr`
- **用途**：保存当前正在编辑的病历数据
- **格式**：JSON对象

## 开发说明

### 添加新功能

1. **新增页面**：
   - 在 `src/views/` 目录创建新的 Vue 组件
   - 在 `src/router/index.ts` 中添加路由配置

2. **新增API接口**：
   - 在 `src/services/backendService.ts` 中添加接口调用函数
   - 在 `src/services/emrOperations.ts` 中添加业务操作函数

3. **新增类型定义**：
   - 在 `src/types/` 目录中添加或修改类型定义文件

### 代码规范

- 使用 TypeScript 严格模式
- 遵循 ESLint 和 Prettier 配置
- 组件使用 Composition API（`<script setup>`）
- 使用语义化的变量和函数命名

### 调试技巧

1. **查看网络请求**：打开浏览器开发者工具的 Network 面板
2. **查看控制台日志**：系统会在控制台输出错误信息
3. **使用 Vue DevTools**：安装 Vue DevTools 浏览器扩展

## 常见问题

### 1. 后端接口连接失败

**问题**：页面显示"调用失败"或网络错误

**解决方案**：
- 检查后端服务是否启动
- 确认 `VITE_API_BASE_URL` 配置是否正确
- 检查浏览器控制台的错误信息
- 确认后端服务支持 CORS 跨域请求

### 2. 病历数据未正确显示

**问题**：对话后病历字段显示"信息不足"

**解决方案**：
- 检查后端返回的数据格式是否正确
- 查看浏览器控制台的网络请求响应
- 确认后端返回的字段名是否匹配（支持驼峰和下划线两种格式）

### 3. 本地缓存数据丢失

**问题**：刷新页面后历史病历记录消失

**解决方案**：
- 这是正常现象，因为使用了 localStorage 存储
- 如果需要持久化，应该将数据保存到后端数据库
- 使用"保存"功能将病历保存到后端

## 项目改进建议

### 已完成功能
- ✅ 对话式病历生成
- ✅ 实时病历同步
- ✅ 病历编辑和保存
- ✅ 病历查询和加载
- ✅ 病历归档
- ✅ 打印功能
- ✅ 本地缓存

### 可改进方向
- 🔄 添加病历删除功能
- 🔄 添加病历导出功能（PDF、Word等）
- 🔄 优化移动端适配
- 🔄 添加病历模板功能
- 🔄 添加用户认证和权限管理
- 🔄 添加病历版本历史记录
- 🔄 优化AI对话体验，支持多轮对话上下文
- 🔄 添加病历字段验证和提示

## 许可证

本项目为内部项目，未经授权不得外传。

## 联系方式

如有问题或建议，请联系开发团队。

---

**最后更新**：2024年12月

